<!DOCTYPE html>
<html lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="Datastax Cassandra Ruby Driver Documentation">
    <meta name="author" content="">

    <title>Datastax Cassandra Ruby Driver - Ssl Encryption</title>

    <link href="../../../css/style.css" rel="stylesheet">
    <link href="../../../css/pygments.css" rel="stylesheet">
    <link href="../../../css/hotkeys.css" rel="stylesheet">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body data-spy="scroll" data-target=".toc" data-offset="0" ng-app="docs">
    <header class="navbar navbar-default navbar-static-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../../">Cassandra Ruby Driver</a>
        </div>
        <div class="collapse navbar-collapse" ng-controller="search">
          <ul class="nav navbar-nav">
            <li><a href="../../../">Introduction</a></li>
            <li class="active"><a href="../../">Features</a></li>
            <li><a href="../../../api/">API docs</a></li>
          </ul>
          <form class="navbar-form form-search navbar-right dropdown visible-lg-block" ng-class="{open: hasResults}" role="search" ng-submit="submit()">
            <div class="form-group has-feedback">
              <input type="search" class="form-control input-sm mousetrap" placeholder="Search..." ng-model="q" ng-change="search()" data-toggle="dropdown" data-hotkey="{down: moveDown, up: moveUp, esc: reset}" data-search>
              <button type="button" class="close form-control-feedback input-sm hidden" ng-click="reset()" ng-class="{hidden: !hasResults}"><span aria-hidden="true">×</span><span class="sr-only">Reset</span></button>
            </div>
            <ul class="dropdown-menu" role="menu">
              <li ng-repeat="result in results" ng-class="{'bg-warning': $index == current}"><a ng-href="{{result.path}}"><span ng-bind-html="summary(result)"></span></a></li>
            </ul>
          </form>
        </div>
      </div>
    </header>

    <div class="container" id="content">
      <div class="row">
        <div class="col-md-9 content">
          <nav class="crumbs">
            <ol class="breadcrumb">
              
              
              
              <li><a href="../../../">Introduction</a></li>
              
              
              
              
              
              <li><a href="../../">Features</a></li>
              
              
              
              
              
              <li><a href="../">Security</a></li>
              
              
              
              
              
              <li class="active">Ssl Encryption</li>
              
              
              
            </ol>
          </nav>
          <div class="feature-section">
<h1 id="ssl-encryption">SSL encryption</h1>
<p>There are a few levels of security that SSL encryption can provide when
communicating with Apache Cassandra. You can find them below in the
increasing security order: the first being the least secure and the last -
the most.</p>

<ol>
<li>Using default SSL context. This method is actually not secure as there is
no peer validation happening. <code>Cassandra.cluster(ssl: true)</code>
</li>
<li>Using shared certificate authority. This method is more secure than the
previous one, because the client is able to validate the identity of the
server. Using this method the server can’t trust the client unless
additional authentication has been provided.
<code>Cassandra.cluster(server_cert: '/path/to/ca.pem')</code>
</li>
<li>Using trusted client certificates. This method, in addition to peer
verification, allows server to validate identities of the clients. Make
sure to enable <code>client_encryption_options.require_client_auth</code> setting in
<code>cassandra.yaml</code>, as well as add all trusted client keys to Apache
Cassandra’s truststore. You can use server certificate as well as client
certificate and private key with an optional passphrase to connect to
Apache Cassandra. <code>Cassandra.cluster(server_cert: '/path/to/ca.pem', client_cert: '/path/to/client.pem', private_key: '/path/to/client.key', passphrase:  'secret passphrase for private key')</code>
</li>
</ol>
<h2 id="using-default-ssl-encryption">Using default SSL encryption</h2>
<dl class="steps">
<dt>Given </dt>
<dd>a running cassandra cluster with SSL encryption enabled</dd>
<dt>And </dt>
<dd>the following example:<pre class="highlight"><code class="ruby"><span class="nb">require</span> <span class="s1">'cassandra'</span>

<span class="k">begin</span>
  <span class="n">cluster</span> <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span><span class="ss">ssl: </span><span class="kp">true</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"connection successful"</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"connection failed"</span>
<span class="k">else</span>
  <span class="n">cluster</span><span class="p">.</span><span class="nf">close</span>
<span class="k">end</span></code></pre>
</dd>
<dt>When </dt>
<dd>it is executed</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>connection successful</code></pre>
</dd>
</dl>
<h2 id="connection-fails-when-not-using-ssl-encryption">Connection fails when not using SSL encryption</h2>
<dl class="steps">
<dt>Given </dt>
<dd>a running cassandra cluster with SSL encryption enabled</dd>
<dt>And </dt>
<dd>the following example:<pre class="highlight"><code class="ruby"><span class="nb">require</span> <span class="s1">'cassandra'</span>

<span class="k">begin</span>
  <span class="n">cluster</span> <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span><span class="ss">ssl: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">connect_timeout: </span><span class="mi">2</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"connection successful"</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"connection failed"</span>
<span class="k">else</span>
  <span class="n">cluster</span><span class="p">.</span><span class="nf">close</span>
<span class="k">end</span></code></pre>
</dd>
<dt>When </dt>
<dd>it is executed</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>connection failed</code></pre>
</dd>
</dl>
<h2 id="using-an-ssl-certificate-authority">Using an SSL certificate authority</h2>
<dl class="steps">
<dt>Given </dt>
<dd>a running cassandra cluster with SSL encryption enabled</dd>
<dt>And </dt>
<dd>the following example:<pre class="highlight"><code class="ruby"><span class="nb">require</span> <span class="s1">'cassandra'</span>

<span class="k">begin</span>
  <span class="n">cluster</span> <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span><span class="ss">server_cert: </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'SERVER_CERT'</span><span class="p">])</span>
  <span class="nb">puts</span> <span class="s2">"connection successful"</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"connection failed"</span>
<span class="k">else</span>
  <span class="n">cluster</span><span class="p">.</span><span class="nf">close</span>
<span class="k">end</span></code></pre>
</dd>
<dt>When </dt>
<dd>it is executed with a valid ca path in the environment</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>connection successful</code></pre>
</dd>
</dl>
<h2 id="using-ssl-authentication">Using SSL authentication</h2>
<dl class="steps">
<dt>Given </dt>
<dd>a running cassandra cluster with SSL client authentication enabled</dd>
<dt>And </dt>
<dd>the following example:<pre class="highlight"><code class="ruby"><span class="nb">require</span> <span class="s1">'cassandra'</span>

<span class="k">begin</span>
  <span class="n">cluster</span> <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span>
    <span class="ss">server_cert:  </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'SERVER_CERT'</span><span class="p">],</span>
    <span class="ss">client_cert:  </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'CLIENT_CERT'</span><span class="p">],</span>
    <span class="ss">private_key:  </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'PRIVATE_KEY'</span><span class="p">],</span>
    <span class="ss">passphrase:   </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'PASSPHRASE'</span><span class="p">]</span>
  <span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"connection successful"</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"connection failed"</span>
<span class="k">else</span>
  <span class="n">cluster</span><span class="p">.</span><span class="nf">close</span>
<span class="k">end</span></code></pre>
</dd>
<dt>When </dt>
<dd>it is executed with ca and cert path and key in the environment</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>connection successful</code></pre>
</dd>
</dl>
<h2 id="using-a-custom-ssl-context">Using a custom SSL context</h2>
<dl class="steps">
<dt>Given </dt>
<dd>a running cassandra cluster with SSL encryption enabled</dd>
<dt>And </dt>
<dd>the following example:<pre class="highlight"><code class="ruby"><span class="nb">require</span> <span class="s1">'cassandra'</span>
<span class="nb">require</span> <span class="s1">'openssl'</span>

<span class="k">begin</span>
  <span class="n">cluster</span> <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span><span class="ss">ssl: </span><span class="no">OpenSSL</span><span class="o">::</span><span class="no">SSL</span><span class="o">::</span><span class="no">SSLContext</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"connection successful"</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"connection failed"</span>
<span class="k">else</span>
  <span class="n">cluster</span><span class="p">.</span><span class="nf">close</span>
<span class="k">end</span></code></pre>
</dd>
<dt>When </dt>
<dd>it is executed</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>connection successful</code></pre>
</dd>
</dl>
</div>
        </div>
        <nav class="col-md-3 side-nav">
          <ol class="nav nav-pills nav-stacked toc" data-spy="affix" data-offset-top="60" data-offset-bottom="25">
            
            
            
            <li><a href="../../basics/">Basics</a></li>
            
            
            
            <li><a href="../../asynchronous_io/">Asynchronous Io</a></li>
            
            
            
            <li class="active">
              <a href="../">Security</a>
              <ul class="nav nav-pills nav-stacked">
                
                
                <li><a href="../standard_authentication/">Standard Authentication</a></li>
                
                
                
                <li class="active">
                  <a href="./">Ssl Encryption</a>
                  <ul class="nav nav-pills nav-stacked">
<li><a href="#using-default-ssl-encryption">Using default SSL encryption</a></li>
<li><a href="#connection-fails-when-not-using-ssl-encryption">Connection fails when not using SSL encryption</a></li>
<li><a href="#using-an-ssl-certificate-authority">Using an SSL certificate authority</a></li>
<li><a href="#using-ssl-authentication">Using SSL authentication</a></li>
<li><a href="#using-a-custom-ssl-context">Using a custom SSL context</a></li>
</ul>
                </li>
                
                
              </ul>
            </li>
            
            
            
            <li><a href="../../debugging/">Debugging</a></li>
            
            
            
            <li><a href="../../load_balancing/">Load Balancing</a></li>
            
            
            
            <li><a href="../../retry_policies/">Retry Policies</a></li>
            
            
            
            <li><a href="../../state_listeners/">State Listeners</a></li>
            
            
            
            <li><a href="../../reconnection/">Reconnection</a></li>
            
            
            
            <li><a href="../../error_handling/">Error Handling</a></li>
            
            
            
            <li><a href="../../address_resolution/">Address Resolution</a></li>
            
            
            
          </ol>
        </nav>
      </div>
    </div>

    <footer class="container text-muted">
      <ul class="list-inline">
        <li>v1.0.0</li>
        <li>·</li>
        <li>
          <a href="https://github.com/datastax/ruby-driver">Code</a>
        </li>
        <li>·</li>
        <li>
          <a href="http://datastax.github.io/ruby-driver/">Docs</a>
        </li>
        <li>·</li>
        <li>
          <a href="https://datastax-oss.atlassian.net/browse/RUBY">Issues</a>
        </li>
        <li>·</li>
        <li>
          <a href="https://groups.google.com/a/lists.datastax.com/forum/#!forum/ruby-driver-user">Mailing List</a>
        </li>
        <li>·</li>
        <li>
          <a href="irc://irc.freenode.net/datastax-drivers">IRC Channel</a>
        </li>
        <li>·</li>
        <li>
          <a href="https://github.com/datastax/ruby-driver/releases">Releases</a>
        </li>
      </ul>
    </footer>
    <script src="//code.jquery.com/jquery-2.1.0.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.3/angular.min.js"></script>
    <script src="../../../js/mousetrap.js"></script>
    <script src="../../../js/hotkeys.js"></script>
    <script src="../../../js/app.js"></script>
    <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-54260831-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
